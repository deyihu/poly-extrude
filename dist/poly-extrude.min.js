/*!
 * poly-extrude v0.0.8
  */
!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((n="undefined"!=typeof globalThis?globalThis:n||self).polyextrude=n.polyextrude||{})}(this,(function(n){"use strict";var e={exports:{}};function t(n,e,t){t=t||2;var x,u,a,v,h,p,y,c=e&&e.length,d=c?e[0]*t:n.length,g=r(n,0,d,t,!0),Z=[];if(!g||g.next===g.prev)return Z;if(c&&(g=function(n,e,t,o){var x,u,a,v=[];for(x=0,u=e.length;x<u;x++)(a=r(n,e[x]*o,x<u-1?e[x+1]*o:n.length,o,!1))===a.next&&(a.steiner=!0),v.push(l(a));for(v.sort(f),x=0;x<v.length;x++)t=i(t=s(v[x],t),t.next);return t}(n,e,g,t)),n.length>80*t){x=a=n[0],u=v=n[1];for(var w=t;w<d;w+=t)(h=n[w])<x&&(x=h),(p=n[w+1])<u&&(u=p),h>a&&(a=h),p>v&&(v=p);y=0!==(y=Math.max(a-x,v-u))?1/y:0}return o(g,Z,t,x,u,y),Z}function r(n,e,t,r,i){var o,x;if(i===F(n,e,t,r)>0)for(o=e;o<t;o+=r)x=P(o,n[o],n[o+1],x);else for(o=t-r;o>=e;o-=r)x=P(o,n[o],n[o+1],x);return x&&g(x,x.next)&&(A(x),x=x.next),x}function i(n,e){if(!n)return n;e||(e=n);var t,r=n;do{if(t=!1,r.steiner||!g(r,r.next)&&0!==d(r.prev,r,r.next))r=r.next;else{if(A(r),(r=e=r.prev)===r.next)break;t=!0}}while(t||r!==e);return e}function o(n,e,t,r,f,s,h){if(n){!h&&s&&function(n,e,t,r){var i=n;do{null===i.z&&(i.z=p(i.x,i.y,e,t,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==n);i.prevZ.nextZ=null,i.prevZ=null,function(n){var e,t,r,i,o,x,u,a,v=1;do{for(t=n,n=null,o=null,x=0;t;){for(x++,r=t,u=0,e=0;e<v&&(u++,r=r.nextZ);e++);for(a=v;u>0||a>0&&r;)0!==u&&(0===a||!r||t.z<=r.z)?(i=t,t=t.nextZ,u--):(i=r,r=r.nextZ,a--),o?o.nextZ=i:n=i,i.prevZ=o,o=i;t=r}o.nextZ=null,v*=2}while(x>1)}(i)}(n,r,f,s);for(var l,y,c=n;n.prev!==n.next;)if(l=n.prev,y=n.next,s?u(n,r,f,s):x(n))e.push(l.i/t),e.push(n.i/t),e.push(y.i/t),A(n),n=y.next,c=y.next;else if((n=y)===c){h?1===h?o(n=a(i(n),e,t),e,t,r,f,s,2):2===h&&v(n,e,t,r,f,s):o(i(n),e,t,r,f,s,1);break}}}function x(n){var e=n.prev,t=n,r=n.next;if(d(e,t,r)>=0)return!1;for(var i=n.next.next;i!==n.prev;){if(y(e.x,e.y,t.x,t.y,r.x,r.y,i.x,i.y)&&d(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function u(n,e,t,r){var i=n.prev,o=n,x=n.next;if(d(i,o,x)>=0)return!1;for(var u=i.x<o.x?i.x<x.x?i.x:x.x:o.x<x.x?o.x:x.x,a=i.y<o.y?i.y<x.y?i.y:x.y:o.y<x.y?o.y:x.y,v=i.x>o.x?i.x>x.x?i.x:x.x:o.x>x.x?o.x:x.x,f=i.y>o.y?i.y>x.y?i.y:x.y:o.y>x.y?o.y:x.y,s=p(u,a,e,t,r),h=p(v,f,e,t,r),l=n.prevZ,c=n.nextZ;l&&l.z>=s&&c&&c.z<=h;){if(l!==n.prev&&l!==n.next&&y(i.x,i.y,o.x,o.y,x.x,x.y,l.x,l.y)&&d(l.prev,l,l.next)>=0)return!1;if(l=l.prevZ,c!==n.prev&&c!==n.next&&y(i.x,i.y,o.x,o.y,x.x,x.y,c.x,c.y)&&d(c.prev,c,c.next)>=0)return!1;c=c.nextZ}for(;l&&l.z>=s;){if(l!==n.prev&&l!==n.next&&y(i.x,i.y,o.x,o.y,x.x,x.y,l.x,l.y)&&d(l.prev,l,l.next)>=0)return!1;l=l.prevZ}for(;c&&c.z<=h;){if(c!==n.prev&&c!==n.next&&y(i.x,i.y,o.x,o.y,x.x,x.y,c.x,c.y)&&d(c.prev,c,c.next)>=0)return!1;c=c.nextZ}return!0}function a(n,e,t){var r=n;do{var o=r.prev,x=r.next.next;!g(o,x)&&Z(o,r,r.next,x)&&m(o,x)&&m(x,o)&&(e.push(o.i/t),e.push(r.i/t),e.push(x.i/t),A(r),A(r.next),r=n=x),r=r.next}while(r!==n);return i(r)}function v(n,e,t,r,x,u){var a=n;do{for(var v=a.next.next;v!==a.prev;){if(a.i!==v.i&&c(a,v)){var f=b(a,v);return a=i(a,a.next),f=i(f,f.next),o(a,e,t,r,x,u),void o(f,e,t,r,x,u)}v=v.next}a=a.next}while(a!==n)}function f(n,e){return n.x-e.x}function s(n,e){var t=function(n,e){var t,r=e,i=n.x,o=n.y,x=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var u=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(u<=i&&u>x){if(x=u,u===i){if(o===r.y)return r;if(o===r.next.y)return r.next}t=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!t)return null;if(i===x)return t;var a,v=t,f=t.x,s=t.y,p=1/0;r=t;do{i>=r.x&&r.x>=f&&i!==r.x&&y(o<s?i:x,o,f,s,o<s?x:i,o,r.x,r.y)&&(a=Math.abs(o-r.y)/(i-r.x),m(r,n)&&(a<p||a===p&&(r.x>t.x||r.x===t.x&&h(t,r)))&&(t=r,p=a)),r=r.next}while(r!==v);return t}(n,e);if(!t)return e;var r=b(t,n),o=i(t,t.next);return i(r,r.next),e===t?o:e}function h(n,e){return d(n.prev,n,e.prev)<0&&d(e.next,n,n.next)<0}function p(n,e,t,r,i){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-t)*i)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function l(n){var e=n,t=n;do{(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next}while(e!==n);return t}function y(n,e,t,r,i,o,x,u){return(i-x)*(e-u)-(n-x)*(o-u)>=0&&(n-x)*(r-u)-(t-x)*(e-u)>=0&&(t-x)*(o-u)-(i-x)*(r-u)>=0}function c(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(n,e){var t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&Z(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}(n,e)&&(m(n,e)&&m(e,n)&&function(n,e){var t=n,r=!1,i=(n.x+e.x)/2,o=(n.y+e.y)/2;do{t.y>o!=t.next.y>o&&t.next.y!==t.y&&i<(t.next.x-t.x)*(o-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next}while(t!==n);return r}(n,e)&&(d(n.prev,n,e.prev)||d(n,e.prev,e))||g(n,e)&&d(n.prev,n,n.next)>0&&d(e.prev,e,e.next)>0)}function d(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function g(n,e){return n.x===e.x&&n.y===e.y}function Z(n,e,t,r){var i=M(d(n,e,t)),o=M(d(n,e,r)),x=M(d(t,r,n)),u=M(d(t,r,e));return i!==o&&x!==u||(!(0!==i||!w(n,t,e))||(!(0!==o||!w(n,r,e))||(!(0!==x||!w(t,n,r))||!(0!==u||!w(t,e,r)))))}function w(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function M(n){return n>0?1:n<0?-1:0}function m(n,e){return d(n.prev,n,n.next)<0?d(n,e,n.next)>=0&&d(n,n.prev,e)>=0:d(n,e,n.prev)<0||d(n,n.next,e)<0}function b(n,e){var t=new z(n.i,n.x,n.y),r=new z(e.i,e.x,e.y),i=n.next,o=e.prev;return n.next=e,e.prev=n,t.next=i,i.prev=t,r.next=t,t.prev=r,o.next=r,r.prev=o,r}function P(n,e,t,r){var i=new z(n,e,t);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function A(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function z(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function F(n,e,t,r){for(var i=0,o=e,x=t-r;o<t;o+=r)i+=(n[x]-n[o])*(n[o+1]+n[x+1]),x=o;return i}e.exports=t,e.exports.default=t,t.deviation=function(n,e,t,r){var i=e&&e.length,o=i?e[0]*t:n.length,x=Math.abs(F(n,0,o,t));if(i)for(var u=0,a=e.length;u<a;u++){var v=e[u]*t,f=u<a-1?e[u+1]*t:n.length;x-=Math.abs(F(n,v,f,t))}var s=0;for(u=0;u<r.length;u+=3){var h=r[u]*t,p=r[u+1]*t,l=r[u+2]*t;s+=Math.abs((n[h]-n[l])*(n[p+1]-n[h+1])-(n[h]-n[p])*(n[l+1]-n[h+1]))}return 0===x&&0===s?0:Math.abs((s-x)/x)},t.flatten=function(n){for(var e=n[0][0].length,t={vertices:[],holes:[],dimensions:e},r=0,i=0;i<n.length;i++){for(var o=0;o<n[i].length;o++)for(var x=0;x<e;x++)t.vertices.push(n[i][o][x]);i>0&&(r+=n[i-1].length,t.holes.push(r))}return t};var j=e.exports;function I(n){for(var e,t,r=0,i=1,o=n.length;i<o;)e=t||n[0],r+=((t=n[i])[0]-e[0])*(t[1]+e[1]),i++;return r>0}function O(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function U(n,e){var t=e[0],r=e[1],i=e[2],o=Math.sqrt(t*t+r*r+i*i)||1;return n[0]=t/o,n[1]=r/o,n[2]=i/o,n}function k(n,e){function t(n,e,t,r){n[0]=e,n[1]=t,n[2]=r}for(var r,i,o,x,u,a,v,f,s,h=[],p=[],l=[],y=[],c=[],d=[],g=n.length,Z=new Float32Array(e.length),w=0;w<g;){var M=3*n[w],m=3*n[w+1],b=3*n[w+2];t(h,e[M],e[M+1],e[M+2]),t(p,e[m],e[m+1],e[m+2]),t(l,e[b],e[b+1],e[b+2]),O(c,l,p),O(y,h,p),r=d,o=y,x=void 0,u=void 0,a=void 0,v=void 0,f=void 0,s=void 0,x=(i=c)[0],u=i[1],a=i[2],v=o[0],f=o[1],s=o[2],r[0]=u*s-a*f,r[1]=a*v-x*s,r[2]=x*f-u*v;for(var P=0;P<3;P++)Z[M+P]+=d[P],Z[m+P]+=d[P],Z[b+P]+=d[P];w+=3}for(var A=0,z=Z.length;A<z;)t(d,Z[A],Z[A+1],Z[A+2]),U(d,d),Z[A]=d[0]||0,Z[A+1]=d[1]||0,Z[A+2]=d[2]||0,A+=3;return Z}function T(n){if(1===n.length)return{position:n[0].position,normal:n[0].normal,uv:n[0].uv,indices:n[0].indices,results:n};for(var e=0,t=0,r=0,i=n.length;r<i;r++){var o=n[r],x=o.position,u=o.indices;e+=x.length,t+=u.length}for(var a={position:new Float32Array(e),normal:new Float32Array(e),uv:new Float32Array(e/3*2),indices:new Uint32Array(t),results:n},v=0,f=0,s=0,h=0,p=0,l=n.length;p<l;p++){var y=n[p],c=y.position,d=y.indices,g=y.normal,Z=y.uv;a.position.set(c,v),a.normal.set(g,v),a.uv.set(Z,h);for(var w=0,M=d.length;w<M;){var m=d[w]+f;a.indices[s]=m,s++,w++}h+=Z.length,v+=c.length,f+=c.length/3}return a}function V(n){return 180*n/Math.PI}function W(n){return n/180*Math.PI}function _(n,e,t,r,i,o){var x=3*t,u=3*r,a=3*i,v=3*o,f=e[x],s=e[x+1],h=e[x+2],p=e[u],l=e[u+1],y=e[u+2],c=e[a],d=e[a+1],g=e[a+2],Z=e[v],w=e[v+1],M=e[v+2];Math.abs(s-l)<Math.abs(f-p)?(n.push(f,1-h),n.push(p,1-y),n.push(c,1-g),n.push(Z,1-M)):(n.push(s,1-h),n.push(l,1-y),n.push(d,1-g),n.push(w,1-M))}function q(n){L(n)||n.push(n[0])}function L(n){var e=n.length,t=n[0],r=t[0],i=t[1],o=n[e-1],x=o[0],u=o[1];return r===x&&i===u}var B={x:0,y:0},C={x:0,y:0};function D(n,e){for(var t=0,r=e.lineWidth/2,i=[],o=[],x=[],u=n.length,a=0;a<u-1;){var v=n[a],f=n[a+1],s=f[1]-v[1],h=f[0]-v[0],p=0,l=V(Math.atan(s/h));if(t=l,0===a)p=l,p-=90;else{var y=n[a-1];B.x=y[0]-v[0],B.y=y[1]-v[1],C.x=f[0]-v[0],C.y=f[1]-v[1],p=l-G(B,C)/2}var c=E(W(p),r,v),d=c[0],g=c[1];i.push(d,g),H(d,v,f)?(o.push(d),x.push(g)):(o.push(g),x.push(d)),a++}var Z=t,w=W(Z-=90),M=n[u-2],m=n[u-1],b=E(w,r,m),P=b[0],A=b[1];return i.push(P,A),H(P,M,m)?(o.push(P),x.push(A)):(o.push(A),x.push(P)),{offsetPoints:i,leftPoints:o,rightPoints:x}}function E(n,e,t){var r=t[0],i=t[1],o=[r+Math.cos(n)*e,i+Math.sin(n)*e],x=n+=Math.PI;return[o,[r+Math.cos(x)*e,i+Math.sin(x)*e]]}var G=function(n,e){var t=n.x,r=n.y,i=e.x,o=e.y,x=t*i+r*o,u=t*o-r*i;return(Math.atan2(u,x)/Math.PI*180+360)%360};function H(n,e,t){var r=e[0],i=e[1],o=t[0],x=t[1];return(i-x)*n[0]+(o-r)*n[1]+r*x-o*i>0}n.expandLine=D,n.extrudePolygons=function(n,e){e=Object.assign({},{depth:2},e);var t=n.map((function(n){for(var t=0,r=n.length;t<r;t++){var i=n[t];q(i),0===t?I(i)||(n[t]=i.reverse()):I(i)&&(n[t]=i.reverse()),L(i)&&i.splice(i.length-1,1)}var o=function(n,e){for(var t=function(n){var e=0,t=0,r=n.length;for(;t<r;)e+=n[t].length,t++;return e}(n),r=n.length,i=[],o=new Float32Array(2*t),x=[],u=[],a=3*t,v=2*t,f=e.depth,s=0,h=0,p=0,l=0;l<r;l++){var y=n[l];l>0&&i.push(s/2);for(var c=0,d=y.length;c<d;){var g=y[c],Z=g[0],w=g[1];o[s++]=Z,o[s++]=w,x[h]=Z,x[h+1]=w,x[h+2]=f,x[a+h]=Z,x[a+h+1]=w,x[a+h+2]=0,u[p]=Z,u[p+1]=w,u[v+p]=Z,u[v+p+1]=w,h+=3,p+=2,c++}}return{flatVertices:o,holes:i,points:x,count:t,uvs:u}}(n,e);return o.polygon=n,function(n,e){for(var t=[],r=n.count,i=0,o=e.length;i<o;i+=3){var x=e[i],u=e[i+1],a=e[i+2];t[i]=x,t[i+1]=u,t[i+2]=a;var v=o+i,f=r+x,s=r+u,h=r+a;t[v]=f,t[v+1]=s,t[v+2]=h}n.index=t}(o,j(o.flatVertices,o.holes,2)),function(n,e){for(var t=n.points,r=n.index,i=n.polygon,o=n.uvs,x=e.depth,u=0,a=i.length;u<a;u++)for(var v=i[u],f=0,s=v.length;f<s;){var h=v[f],p=v[f+1];f===s-1&&(p=v[0]);var l=t.length/3,y=h[0],c=h[1],d=p[0],g=p[1];t.push(y,c,x,d,g,x,y,c,0,d,g,0);var Z=l+2,w=l+3,M=l,m=l+1;r.push(Z,M,w,M,m,w),_(o,t,Z,w,M,m),f++}}(o,e),o.position=new Float32Array(o.points),o.indices=new Uint32Array(o.index),o.uv=new Float32Array(o.uvs),o.normal=k(o.indices,o.position),o})),r=T(t);return r.polygons=n,r},n.extrudePolylines=function(n,e){e=Object.assign({},{depth:2,lineWidth:1},e);var t=n.map((function(n){var t=D(n,e);return t.line=n,function(n,e){var t=e.depth,r=[],i=[],o=[],x=n.leftPoints,u=n.rightPoints,a=0,v=x.length;for(;a<v;){var f=3*a,s=x[a],h=s[0],p=s[1];r[f]=h,r[f+1]=p,r[f+2]=t;var l=u[a],y=l[0],c=l[1],d=3*v+f;r[d]=y,r[d+1]=c,r[d+2]=t;var g=2*v*3+f;r[g]=h,r[g+1]=p,r[g+2]=0;var Z=2*v*3+3*v+f;r[Z]=y,r[Z+1]=c,r[Z+2]=0,a++}a=0,v=r.length;for(;a<v;){var w=r[a],M=r[a+1];o.push(w,M),a+=3}a=0,v=x.length;for(;a<v-1;){var m=a,b=a+1,P=m+v,A=b+v;i.push(m,P,b),i.push(P,A,b);var z=a+2*v,F=z+1,j=z+v,I=F+v;i.push(z,j,F),i.push(j,I,F),a++}n.index=i,n.points=r,n.uvs=o}(t,e),function(n,e){var t=n.points,r=n.index,i=n.leftPoints,o=n.rightPoints,x=n.uvs,u=e.depth,a=[i,o];function v(n,e){var i=t.length/3;t.push(n[0],n[1],u,e[0],e[1],u,n[0],n[1],0,e[0],e[1],0);var o=i+2,a=i+3,v=i,f=i+1;r.push(o,v,a,v,f,a),_(x,t,o,a,v,f)}for(var f=0,s=a.length;f<s;f++){var h=a[f];f>0&&(h=(h=h.map((function(n){return n}))).reverse());for(var p=0,l=h.length-1;p<l;){v(h[p],h[p+1]),p++}}for(var y=i.length,c=[o[0],i[0],i[y-1],o[y-1]],d=0;d<c.length;d+=2){v(c[d],c[d+1])}}(t,e),t.position=new Float32Array(t.points),t.indices=new Uint32Array(t.index),t.uv=new Float32Array(t.uvs),t.normal=k(t.indices,t.position),t})),r=T(t);return r.lines=n,r},Object.defineProperty(n,"__esModule",{value:!0})}));
