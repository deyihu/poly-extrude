/*!
 * poly-extrude v0.2.0
  */
!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((n="undefined"!=typeof globalThis?globalThis:n||self).polyextrude=n.polyextrude||{})}(this,(function(n){"use strict";var e={exports:{}};function t(n,e,t){t=t||2;var i,a,u,v,x,f,l,y=e&&e.length,c=y?e[0]*t:n.length,g=r(n,0,c,t,!0),d=[];if(!g||g.next===g.prev)return d;if(y&&(g=function(n,e,t,i){var o,a,u,v=[];for(o=0,a=e.length;o<a;o++)(u=r(n,e[o]*i,o<a-1?e[o+1]*i:n.length,i,!1))===u.next&&(u.steiner=!0),v.push(p(u));for(v.sort(s),o=0;o<v.length;o++)t=h(v[o],t);return t}(n,e,g,t)),n.length>80*t){i=u=n[0],a=v=n[1];for(var w=t;w<c;w+=t)(x=n[w])<i&&(i=x),(f=n[w+1])<a&&(a=f),x>u&&(u=x),f>v&&(v=f);l=0!==(l=Math.max(u-i,v-a))?32767/l:0}return o(g,d,t,i,a,l,0),d}function r(n,e,t,r,i){var o,a;if(i===z(n,e,t,r)>0)for(o=e;o<t;o+=r)a=b(o,n[o],n[o+1],a);else for(o=t-r;o>=e;o-=r)a=b(o,n[o],n[o+1],a);return a&&d(a,a.next)&&(P(a),a=a.next),a}function i(n,e){if(!n)return n;e||(e=n);var t,r=n;do{if(t=!1,r.steiner||!d(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(P(r),(r=e=r.prev)===r.next)break;t=!0}}while(t||r!==e);return e}function o(n,e,t,r,s,h,f){if(n){!f&&h&&function(n,e,t,r){var i=n;do{0===i.z&&(i.z=l(i.x,i.y,e,t,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==n);i.prevZ.nextZ=null,i.prevZ=null,function(n){var e,t,r,i,o,a,u,v,x=1;do{for(t=n,n=null,o=null,a=0;t;){for(a++,r=t,u=0,e=0;e<x&&(u++,r=r.nextZ);e++);for(v=x;u>0||v>0&&r;)0!==u&&(0===v||!r||t.z<=r.z)?(i=t,t=t.nextZ,u--):(i=r,r=r.nextZ,v--),o?o.nextZ=i:n=i,i.prevZ=o,o=i;t=r}o.nextZ=null,x*=2}while(a>1)}(i)}(n,r,s,h);for(var p,y,c=n;n.prev!==n.next;)if(p=n.prev,y=n.next,h?u(n,r,s,h):a(n))e.push(p.i/t|0),e.push(n.i/t|0),e.push(y.i/t|0),P(n),n=y.next,c=y.next;else if((n=y)===c){f?1===f?o(n=v(i(n),e,t),e,t,r,s,h,2):2===f&&x(n,e,t,r,s,h):o(i(n),e,t,r,s,h,1);break}}}function a(n){var e=n.prev,t=n,r=n.next;if(g(e,t,r)>=0)return!1;for(var i=e.x,o=t.x,a=r.x,u=e.y,v=t.y,x=r.y,s=i<o?i<a?i:a:o<a?o:a,h=u<v?u<x?u:x:v<x?v:x,f=i>o?i>a?i:a:o>a?o:a,l=u>v?u>x?u:x:v>x?v:x,p=r.next;p!==e;){if(p.x>=s&&p.x<=f&&p.y>=h&&p.y<=l&&y(i,u,o,v,a,x,p.x,p.y)&&g(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function u(n,e,t,r){var i=n.prev,o=n,a=n.next;if(g(i,o,a)>=0)return!1;for(var u=i.x,v=o.x,x=a.x,s=i.y,h=o.y,f=a.y,p=u<v?u<x?u:x:v<x?v:x,c=s<h?s<f?s:f:h<f?h:f,d=u>v?u>x?u:x:v>x?v:x,w=s>h?s>f?s:f:h>f?h:f,M=l(p,c,e,t,r),Z=l(d,w,e,t,r),m=n.prevZ,A=n.nextZ;m&&m.z>=M&&A&&A.z<=Z;){if(m.x>=p&&m.x<=d&&m.y>=c&&m.y<=w&&m!==i&&m!==a&&y(u,s,v,h,x,f,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;if(m=m.prevZ,A.x>=p&&A.x<=d&&A.y>=c&&A.y<=w&&A!==i&&A!==a&&y(u,s,v,h,x,f,A.x,A.y)&&g(A.prev,A,A.next)>=0)return!1;A=A.nextZ}for(;m&&m.z>=M;){if(m.x>=p&&m.x<=d&&m.y>=c&&m.y<=w&&m!==i&&m!==a&&y(u,s,v,h,x,f,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;A&&A.z<=Z;){if(A.x>=p&&A.x<=d&&A.y>=c&&A.y<=w&&A!==i&&A!==a&&y(u,s,v,h,x,f,A.x,A.y)&&g(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function v(n,e,t){var r=n;do{var o=r.prev,a=r.next.next;!d(o,a)&&w(o,r,r.next,a)&&m(o,a)&&m(a,o)&&(e.push(o.i/t|0),e.push(r.i/t|0),e.push(a.i/t|0),P(r),P(r.next),r=n=a),r=r.next}while(r!==n);return i(r)}function x(n,e,t,r,a,u){var v=n;do{for(var x=v.next.next;x!==v.prev;){if(v.i!==x.i&&c(v,x)){var s=A(v,x);return v=i(v,v.next),s=i(s,s.next),o(v,e,t,r,a,u,0),void o(s,e,t,r,a,u,0)}x=x.next}v=v.next}while(v!==n)}function s(n,e){return n.x-e.x}function h(n,e){var t=function(n,e){var t,r=e,i=n.x,o=n.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var u=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(u<=i&&u>a&&(a=u,t=r.x<r.next.x?r:r.next,u===i))return t}r=r.next}while(r!==e);if(!t)return null;var v,x=t,s=t.x,h=t.y,l=1/0;r=t;do{i>=r.x&&r.x>=s&&i!==r.x&&y(o<h?i:a,o,s,h,o<h?a:i,o,r.x,r.y)&&(v=Math.abs(o-r.y)/(i-r.x),m(r,n)&&(v<l||v===l&&(r.x>t.x||r.x===t.x&&f(t,r)))&&(t=r,l=v)),r=r.next}while(r!==x);return t}(n,e);if(!t)return e;var r=A(t,n);return i(r,r.next),i(t,t.next)}function f(n,e){return g(n.prev,n,e.prev)<0&&g(e.next,n,n.next)<0}function l(n,e,t,r,i){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-t)*i|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function p(n){var e=n,t=n;do{(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next}while(e!==n);return t}function y(n,e,t,r,i,o,a,u){return(i-a)*(e-u)>=(n-a)*(o-u)&&(n-a)*(r-u)>=(t-a)*(e-u)&&(t-a)*(o-u)>=(i-a)*(r-u)}function c(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(n,e){var t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&w(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}(n,e)&&(m(n,e)&&m(e,n)&&function(n,e){var t=n,r=!1,i=(n.x+e.x)/2,o=(n.y+e.y)/2;do{t.y>o!=t.next.y>o&&t.next.y!==t.y&&i<(t.next.x-t.x)*(o-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next}while(t!==n);return r}(n,e)&&(g(n.prev,n,e.prev)||g(n,e.prev,e))||d(n,e)&&g(n.prev,n,n.next)>0&&g(e.prev,e,e.next)>0)}function g(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function d(n,e){return n.x===e.x&&n.y===e.y}function w(n,e,t,r){var i=Z(g(n,e,t)),o=Z(g(n,e,r)),a=Z(g(t,r,n)),u=Z(g(t,r,e));return i!==o&&a!==u||(!(0!==i||!M(n,t,e))||(!(0!==o||!M(n,r,e))||(!(0!==a||!M(t,n,r))||!(0!==u||!M(t,e,r)))))}function M(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function Z(n){return n>0?1:n<0?-1:0}function m(n,e){return g(n.prev,n,n.next)<0?g(n,e,n.next)>=0&&g(n,n.prev,e)>=0:g(n,e,n.prev)<0||g(n,n.next,e)<0}function A(n,e){var t=new F(n.i,n.x,n.y),r=new F(e.i,e.x,e.y),i=n.next,o=e.prev;return n.next=e,e.prev=n,t.next=i,i.prev=t,r.next=t,t.prev=r,o.next=r,r.prev=o,r}function b(n,e,t,r){var i=new F(n,e,t);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function P(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function F(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function z(n,e,t,r){for(var i=0,o=e,a=t-r;o<t;o+=r)i+=(n[a]-n[o])*(n[o+1]+n[a+1]),a=o;return i}e.exports=t,e.exports.default=t,t.deviation=function(n,e,t,r){var i=e&&e.length,o=i?e[0]*t:n.length,a=Math.abs(z(n,0,o,t));if(i)for(var u=0,v=e.length;u<v;u++){var x=e[u]*t,s=u<v-1?e[u+1]*t:n.length;a-=Math.abs(z(n,x,s,t))}var h=0;for(u=0;u<r.length;u+=3){var f=r[u]*t,l=r[u+1]*t,p=r[u+2]*t;h+=Math.abs((n[f]-n[p])*(n[l+1]-n[f+1])-(n[f]-n[l])*(n[p+1]-n[f+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},t.flatten=function(n){for(var e=n[0][0].length,t={vertices:[],holes:[],dimensions:e},r=0,i=0;i<n.length;i++){for(var o=0;o<n[i].length;o++)for(var a=0;a<e;a++)t.vertices.push(n[i][o][a]);i>0&&(r+=n[i-1].length,t.holes.push(r))}return t};var j=e.exports;function I(n){for(var e,t,r=0,i=1,o=n.length;i<o;)e=t||n[0],r+=((t=n[i])[0]-e[0])*(t[1]+e[1]),i++;return r>0}function O(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function U(n,e){var t=e[0],r=e[1],i=e[2],o=Math.sqrt(t*t+r*r+i*i)||1;return n[0]=t/o,n[1]=r/o,n[2]=i/o,n}function k(n,e){function t(n,e,t,r){n[0]=e,n[1]=t,n[2]=r}for(var r,i,o,a,u,v,x,s,h,f=[],l=[],p=[],y=[],c=[],g=[],d=n.length,w=new Float32Array(e.length),M=0;M<d;){var Z=3*n[M],m=3*n[M+1],A=3*n[M+2];t(f,e[Z],e[Z+1],e[Z+2]),t(l,e[m],e[m+1],e[m+2]),t(p,e[A],e[A+1],e[A+2]),O(c,p,l),O(y,f,l),r=g,o=y,a=void 0,u=void 0,v=void 0,x=void 0,s=void 0,h=void 0,a=(i=c)[0],u=i[1],v=i[2],x=o[0],s=o[1],h=o[2],r[0]=u*h-v*s,r[1]=v*x-a*h,r[2]=a*s-u*x;for(var b=0;b<3;b++)w[Z+b]+=g[b],w[m+b]+=g[b],w[A+b]+=g[b];M+=3}for(var P=0,F=w.length;P<F;)t(g,w[P],w[P+1],w[P+2]),U(g,g),w[P]=g[0]||0,w[P+1]=g[1]||0,w[P+2]=g[2]||0,P+=3;return w}function S(n){if(1===n.length)return{position:n[0].position,normal:n[0].normal,uv:n[0].uv,indices:n[0].indices,results:n};for(var e=0,t=0,r=0,i=n.length;r<i;r++){var o=n[r],a=o.position,u=o.indices;e+=a.length,t+=u.length}for(var v={position:new Float32Array(e),normal:new Float32Array(e),uv:new Float32Array(e/3*2),indices:new Uint32Array(t),results:n},x=0,s=0,h=0,f=0,l=0,p=n.length;l<p;l++){var y=n[l],c=y.position,g=y.indices,d=y.normal,w=y.uv;v.position.set(c,x),v.normal.set(d,x),v.uv.set(w,f);for(var M=0,Z=g.length;M<Z;){var m=g[M]+s;v.indices[h]=m,h++,M++}f+=w.length,x+=c.length,s+=c.length/3}return v}function T(n){return 180*n/Math.PI}function V(n){return n/180*Math.PI}function W(n,e,t,r,i,o){var a=3*t,u=3*r,v=3*i,x=3*o,s=e[a],h=e[a+1],f=e[a+2],l=e[u],p=e[u+1],y=e[u+2],c=e[v],g=e[v+1],d=e[v+2],w=e[x],M=e[x+1],Z=e[x+2];Math.abs(h-p)<Math.abs(s-l)?(n.push(s,1-f),n.push(l,1-y),n.push(c,1-d),n.push(w,1-Z)):(n.push(h,1-f),n.push(p,1-y),n.push(g,1-d),n.push(M,1-Z))}function _(n){q(n)||n.push(n[0])}function q(n){var e=n.length,t=n[0],r=t[0],i=t[1],o=n[e-1],a=o[0],u=o[1];return r===a&&i===u}var L={x:0,y:0},B={x:0,y:0};function C(n,e){for(var t=0,r=e.lineWidth/2,i=[],o=[],a=[],u=n.length,v=0;v<u-1;){var x=n[v],s=n[v+1],h=s[1]-x[1],f=s[0]-x[0],l=0,p=T(Math.atan(h/f));if(t=p,0===v)l=p,l-=90;else{var y=n[v-1];L.x=y[0]-x[0],L.y=y[1]-x[1],B.x=s[0]-x[0],B.y=s[1]-x[1],l=p-E(L,B)/2}var c=D(V(l),r,x),g=c[0],d=c[1];i.push(g,d),G(g,x,s)?(o.push(g),a.push(d)):(o.push(d),a.push(g)),v++}var w=t,M=V(w-=90),Z=n[u-2],m=n[u-1],A=D(M,r,m),b=A[0],P=A[1];return i.push(b,P),G(b,Z,m)?(o.push(b),a.push(P)):(o.push(P),a.push(b)),{offsetPoints:i,leftPoints:o,rightPoints:a}}function D(n,e,t){var r=t[0],i=t[1],o=t[2]||0,a=[r+Math.cos(n)*e,i+Math.sin(n)*e,o],u=n+=Math.PI;return[a,[r+Math.cos(u)*e,i+Math.sin(u)*e,o]]}var E=function(n,e){var t=n.x,r=n.y,i=e.x,o=e.y,a=t*i+r*o,u=t*o-r*i;return(Math.atan2(u,a)/Math.PI*180+360)%360};function G(n,e,t){var r=e[0],i=e[1],o=t[0],a=t[1];return(i-a)*n[0]+(o-r)*n[1]+r*a-o*i>0}n.cylinder=function(n,e){void 0===e&&(e={}),e=Object.assign({},{radius:1,height:2,radialSegments:6},e);for(var t=Math.round(Math.max(4,e.radialSegments)),r=e,i=r.radius,o=r.height,a=360/t/360*Math.PI*2,u=t+1,v=new Float32Array(3*u*2),x=n[0],s=n[1],h=0,f=0,l=3*u,p=2*u,y=[],c=[],g=-1;g<t;g++){var d=a*g,w=Math.cos(d)*i+x,M=Math.sin(d)*i+s;v[h]=w,v[h+1]=M,v[h+2]=0,v[h+l]=w,v[h+1+l]=M,v[h+2+l]=o;var Z,m;Z=.5+w/i/2,m=.5+M/i/2,c[f]=Z,c[f+1]=m,c[f+p]=Z,c[f+1+p]=m,h+=3,f+=2,g>1&&y.push(0,g-1,g)}v[h-=3]=v[0],v[h+1]=v[1],v[h+2]=v[2];var A=v.length;v[A-3]=v[0],v[A-2]=v[1],v[A-1]=o;for(var b=y.length,P=0;P<b;P++){var F=y[P];y.push(F+u)}var z=new Float32Array(2*(3*u*2-6)),j=-1;h=2*u,f=0;for(var I=0,O=v.length/2;I<O-3;I+=3){var U=v[I],S=v[I+1],T=v[I+3],V=v[I+4];z[++j]=U,z[++j]=S,z[++j]=o,z[++j]=T,z[++j]=V,z[++j]=o,z[++j]=U,z[++j]=S,z[++j]=0,z[++j]=T,z[++j]=V,z[++j]=0;var W=h+2,_=h+3,q=h,L=h+1;y.push(q,W,L,W,_,L),h+=4;var B=f/u,C=(f+1)/u;c.push(B,o/i/2,C,o/i/2,B,0,C,0),f++}var D=new Float32Array(v.length+z.length);D.set(v,0),D.set(z,v.length);var E=k(y,D);return{points:v,indices:new Uint32Array(y),position:D,normal:E,uv:new Float32Array(c)}},n.expandLine=C,n.extrudePolygons=function(n,e){e=Object.assign({},{depth:2},e);var t=n.map((function(n){for(var t=0,r=n.length;t<r;t++){var i=n[t];_(i),0===t?I(i)||(n[t]=i.reverse()):I(i)&&(n[t]=i.reverse()),q(i)&&i.splice(i.length-1,1)}var o=function(n,e){for(var t=function(n){var e=0,t=0,r=n.length;for(;t<r;)e+=n[t].length,t++;return e}(n),r=n.length,i=[],o=new Float32Array(2*t),a=[],u=[],v=3*t,x=2*t,s=e.depth,h=0,f=0,l=0,p=0;p<r;p++){var y=n[p];p>0&&i.push(h/2);for(var c=0,g=y.length;c<g;){var d=y[c],w=d[0],M=d[1];o[h++]=w,o[h++]=M,a[f]=w,a[f+1]=M,a[f+2]=s,a[v+f]=w,a[v+f+1]=M,a[v+f+2]=0,u[l]=w,u[l+1]=M,u[x+l]=w,u[x+l+1]=M,f+=3,l+=2,c++}}return{flatVertices:o,holes:i,points:a,count:t,uvs:u}}(n,e);return o.polygon=n,function(n,e){for(var t=[],r=n.count,i=0,o=e.length;i<o;i+=3){var a=e[i],u=e[i+1],v=e[i+2];t[i]=a,t[i+1]=u,t[i+2]=v;var x=o+i,s=r+a,h=r+u,f=r+v;t[x]=s,t[x+1]=h,t[x+2]=f}n.index=t}(o,j(o.flatVertices,o.holes,2)),function(n,e){for(var t=n.points,r=n.index,i=n.polygon,o=n.uvs,a=e.depth,u=0,v=i.length;u<v;u++)for(var x=i[u],s=0,h=x.length;s<h;){var f=x[s],l=x[s+1];s===h-1&&(l=x[0]);var p=t.length/3,y=f[0],c=f[1],g=l[0],d=l[1];t.push(y,c,a,g,d,a,y,c,0,g,d,0);var w=p+2,M=p+3,Z=p,m=p+1;r.push(w,Z,M,Z,m,M),W(o,t,w,M,Z,m),s++}}(o,e),o.position=new Float32Array(o.points),o.indices=new Uint32Array(o.index),o.uv=new Float32Array(o.uvs),o.normal=k(o.indices,o.position),o})),r=S(t);return r.polygons=n,r},n.extrudePolylines=function(n,e){e=Object.assign({},{depth:2,lineWidth:1},e);var t=n.map((function(n){var t=C(n,e);return t.line=n,function(n,e){var t=e.depth,r=[],i=[],o=[],a=n.leftPoints,u=n.rightPoints,v=0,x=a.length;for(;v<x;){var s=3*v,h=a[v],f=h[0],l=h[1],p=h[2];r[s]=f,r[s+1]=l,r[s+2]=t+p;var y=u[v],c=y[0],g=y[1],d=y[2],w=3*x+s;r[w]=c,r[w+1]=g,r[w+2]=t+d;var M=2*x*3+s;r[M]=f,r[M+1]=l,r[M+2]=p;var Z=2*x*3+3*x+s;r[Z]=c,r[Z+1]=g,r[Z+2]=d,v++}v=0,x=r.length;for(;v<x;){var m=r[v],A=r[v+1];o.push(m,A),v+=3}v=0,x=a.length;for(;v<x-1;){var b=v,P=v+1,F=b+x,z=P+x;i.push(b,F,P),i.push(F,z,P);var j=v+2*x,I=j+1,O=j+x,U=I+x;i.push(j,O,I),i.push(O,U,I),v++}n.index=i,n.points=r,n.uvs=o}(t,e),function(n,e){var t=n.points,r=n.index,i=n.leftPoints,o=n.rightPoints,a=n.uvs,u=e.depth,v=[i,o];function x(n,e){var i=t.length/3;t.push(n[0],n[1],u+n[2],e[0],e[1],u+e[2],n[0],n[1],n[2],e[0],e[1],e[2]);var o=i+2,v=i+3,x=i,s=i+1;r.push(o,x,v,x,s,v),W(a,t,o,v,x,s)}for(var s=0,h=v.length;s<h;s++){var f=v[s];s>0&&(f=(f=f.map((function(n){return n}))).reverse());for(var l=0,p=f.length-1;l<p;){x(f[l],f[l+1]),l++}}for(var y=i.length,c=[o[0],i[0],i[y-1],o[y-1]],g=0;g<c.length;g+=2){x(c[g],c[g+1])}}(t,e),t.position=new Float32Array(t.points),t.indices=new Uint32Array(t.index),t.uv=new Float32Array(t.uvs),t.normal=k(t.indices,t.position),t})),r=S(t);return r.lines=n,r},Object.defineProperty(n,"__esModule",{value:!0})}));
